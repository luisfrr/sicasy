<ui:composition
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:h="http://xmlns.jcp.org/jsf/html"
        xmlns:f="http://xmlns.jcp.org/jsf/core"
        xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
        xmlns:p="http://primefaces.org/ui">

   <h:form id="form_editar_vehiculo">
      <p:panel header="Datos del vehículo" widgetVar="panelVehiculo" styleClass="mb-5">
         <f:facet name="actions">
            <p:commandLink styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default"
                           ajax="true" action="#{vehiculoView.permitirEditar()}"
                           rendered="#{vehiculoView.readOnlyEditForm}">
               <h:outputText styleClass="ui-icon pi pi-pencil"/>
            </p:commandLink>
         </f:facet>
         <p:outputPanel styleClass="formgrid grid mb-5">
            <p:outputPanel styleClass="field col-12 md:col-6 lg:col-4 xl:col-3">
               <p:outputLabel for="@next" value="Dependencia" styleClass="block"/>
               <p:selectOneMenu value="#{vehiculoView.vehiculoSelected.dependencia.idDependencia}"
                                styleClass="w-full mw-auto" required="true" disabled="#{vehiculoView.readOnlyEditForm}">
                  <f:selectItem itemLabel="Seleccione uno..." itemValue="#{null}"/>
                  <f:selectItems value="#{vehiculoView.dependenciaList}" var="dependencia"
                                 itemValue="#{dependencia.idDependencia}" itemLabel="#{dependencia.abreviatura} - #{dependencia.nombre}"/>
               </p:selectOneMenu>
               <span class="text-sm hidden"> </span>
            </p:outputPanel>
            <p:outputPanel styleClass="field col-12 md:col-6 lg:col-4 xl:col-3">
               <p:outputLabel for="@next" value="No. Serie" styleClass="block"/>
               <p:inputText styleClass="block w-full" required="true" disabled="#{vehiculoView.readOnlyEditForm}"
                            value="#{vehiculoView.vehiculoSelected.noSerie}"/>
               <span class="text-sm hidden"> </span>
            </p:outputPanel>
            <p:outputPanel styleClass="field col-12 md:col-6 lg:col-4 xl:col-3">
               <p:outputLabel for="@next" value="Placa" styleClass="block"/>
               <p:inputText styleClass="block w-full" required="true" disabled="#{vehiculoView.readOnlyEditForm}"
                            value="#{vehiculoView.vehiculoSelected.placa}"/>
               <span class="text-sm hidden"> </span>
            </p:outputPanel>
            <p:outputPanel styleClass="field col-12 md:col-6 lg:col-4 xl:col-3">
               <p:outputLabel for="@next" value="Marca" styleClass="block"/>
               <p:inputText styleClass="block w-full" required="true"
                            placeholder="Ej. Nissan" disabled="#{vehiculoView.readOnlyEditForm}"
                            value="#{vehiculoView.vehiculoSelected.marca}"/>
               <span class="text-sm hidden"> </span>
            </p:outputPanel>
            <p:outputPanel styleClass="field col-12 md:col-6 lg:col-4 xl:col-3">
               <p:outputLabel for="@next" value="Modelo" styleClass="block"/>
               <p:inputText styleClass="block w-full" required="true"
                            placeholder="Ej. Altima" disabled="#{vehiculoView.readOnlyEditForm}"
                            value="#{vehiculoView.vehiculoSelected.modelo}"/>
               <span class="text-sm hidden"> </span>
            </p:outputPanel>
            <p:outputPanel styleClass="field col-12 md:col-6 lg:col-4 xl:col-3">
               <p:outputLabel for="@next" value="Año" styleClass="block"/>
               <p:inputNumber styleClass="block w-full" required="true"
                              placeholder="Ej. 2022" disabled="#{vehiculoView.readOnlyEditForm}"
                              value="#{vehiculoView.vehiculoSelected.anio}"/>
               <span class="text-sm hidden"> </span>
            </p:outputPanel>
            <p:outputPanel styleClass="field col-12 md:col-6 lg:col-4 xl:col-3">
               <p:outputLabel for="@next" value="No. Motor" styleClass="block"/>
               <p:inputText styleClass="block w-full" required="true" disabled="#{vehiculoView.readOnlyEditForm}"
                            value="#{vehiculoView.vehiculoSelected.noMotor}"/>
               <span class="text-sm hidden"> </span>
            </p:outputPanel>
            <p:outputPanel styleClass="field col-12 md:col-6 lg:col-4 xl:col-3">
               <p:outputLabel for="@next" value="Color" styleClass="block"/>
               <p:inputText styleClass="block w-full" required="true"
                            placeholder="Ej. Rojo" disabled="#{vehiculoView.readOnlyEditForm}"
                            value="#{vehiculoView.vehiculoSelected.color}"/>
               <span class="text-sm hidden"> </span>
            </p:outputPanel>
            <p:outputPanel styleClass="field col-12 md:col-6 lg:col-4 xl:col-3">
               <p:outputLabel for="@next" value="Condición" styleClass="block"/>
               <p:selectOneMenu value="#{vehiculoView.vehiculoSelected.condicionVehiculo.idCondicionVehiculo}"
                                styleClass="w-full mw-auto" required="true" disabled="#{vehiculoView.readOnlyEditForm}">
                  <f:selectItem itemLabel="Seleccione uno..." itemValue="#{null}"/>
                  <f:selectItems value="#{vehiculoView.condicionVehiculoList}" var="condicionVehiculo"
                                 itemValue="#{condicionVehiculo.idCondicionVehiculo}" itemLabel="#{condicionVehiculo.nombre}"/>
               </p:selectOneMenu>
               <span class="text-sm hidden"> </span>
            </p:outputPanel>
            <p:outputPanel styleClass="field col-12 md:col-6 lg:col-4 xl:col-3">
               <p:outputLabel for="@next" value="No. Factura" styleClass="block"/>
               <p:inputText styleClass="block w-full" required="true" disabled="#{vehiculoView.readOnlyEditForm}"
                            value="#{vehiculoView.vehiculoSelected.noFactura}"/>
               <span class="text-sm hidden"> </span>
            </p:outputPanel>
            <p:outputPanel styleClass="field col-12 md:col-6 lg:col-4 xl:col-3">
               <p:outputLabel for="@next" value="Valor factura" styleClass="block"/>
               <p:inputNumber styleClass="block w-full" required="true" disabled="#{vehiculoView.readOnlyEditForm}"
                              value="#{vehiculoView.vehiculoSelected.montoFactura}"/>
               <span class="text-sm hidden"> </span>
            </p:outputPanel>
            <p:outputPanel styleClass="field col-12 md:col-6 lg:col-4 xl:col-3">
               <p:outputLabel for="@next" value="Renta mensual" styleClass="block"/>
               <p:inputNumber styleClass="block w-full" required="true" disabled="#{vehiculoView.readOnlyEditForm}"
                              value="#{vehiculoView.vehiculoSelected.rentaMensual}"/>
               <span class="text-sm hidden"> </span>
            </p:outputPanel>
            <p:outputPanel styleClass="field col-12">
               <p:outputLabel for="@next" value="Descripción" styleClass="block"/>
               <p:inputTextarea styleClass="block w-full" rows="2" autoResize="true"
                                disabled="#{vehiculoView.readOnlyEditForm}"
                                value="#{vehiculoView.vehiculoSelected.descripcionVehiculo}"/>
               <span class="text-sm hidden"> </span>
            </p:outputPanel>
            <p:outputPanel styleClass="field col-12 md:col-6 lg:col-4 xl:col-3">
               <p:outputLabel for="@next" value="Licitación" styleClass="block"/>
               <p:selectOneMenu value="#{vehiculoView.vehiculoSelected.licitacion.idLicitacion}"
                                disabled="#{vehiculoView.readOnlyEditForm}"
                                styleClass="w-full mw-auto">
                  <f:selectItem itemLabel="Seleccione una..." itemValue="#{null}"/>
                  <f:selectItems value="#{vehiculoView.licitacionFormList}" var="licitacion"
                                 itemValue="#{licitacion.idLicitacion}" itemLabel="#{licitacion.numeroLicitacion}"/>
                  <p:ajax event="change" listener="#{vehiculoView.onChangeLicitacionForm()}" update="tab_view_detalles:form_editar_vehiculo"/>
               </p:selectOneMenu>
               <span class="text-sm hidden"> </span>
            </p:outputPanel>
            <p:outputPanel styleClass="field col-12 md:col-6 lg:col-4 xl:col-3">
               <p:outputLabel for="@next" value="Anexo" styleClass="block"/>
               <p:selectOneMenu value="#{vehiculoView.vehiculoSelected.anexo.idAnexo}"
                                disabled="#{vehiculoView.readOnlyEditForm}"
                                styleClass="w-full mw-auto">
                  <f:selectItem itemLabel="Seleccione una..." itemValue="#{null}"/>
                  <f:selectItems value="#{vehiculoView.anexoFormList}" var="anexo"
                                 itemValue="#{anexo.idAnexo}" itemLabel="#{anexo.nombre}"/>
               </p:selectOneMenu>
               <span class="text-sm hidden"> </span>
            </p:outputPanel>
            <p:outputPanel styleClass="field col-12 md:col-6 lg:col-4 xl:col-3">
               <p:outputLabel for="@next" value="Dependencia asignada" styleClass="block"/>
               <p:selectOneMenu value="#{vehiculoView.vehiculoSelected.dependenciaAsignada.idDependencia}"
                                disabled="#{vehiculoView.readOnlyEditForm}"
                                styleClass="w-full mw-auto">
                  <f:selectItem itemLabel="Seleccione una..." itemValue="#{null}"/>
                  <f:selectItems value="#{vehiculoView.dependenciaList}" var="dependencia"
                                 itemValue="#{dependencia.idDependencia}" itemLabel="#{dependencia.abreviatura} - #{dependencia.nombre}"/>
               </p:selectOneMenu>
               <span class="text-sm hidden"> </span>
            </p:outputPanel>
            <p:outputPanel styleClass="field col-12 md:col-6 lg:col-4 xl:col-3">
               <p:outputLabel for="@next" value="Resguardante" styleClass="block"/>
               <p:inputText styleClass="block w-full" disabled="#{vehiculoView.readOnlyEditForm}"
                            value="#{vehiculoView.vehiculoSelected.resguardante}"/>
               <span class="text-sm hidden"> </span>
            </p:outputPanel>
            <p:outputPanel styleClass="field col-12 md:col-6 lg:col-4 xl:col-3">
               <p:outputLabel for="@next" value="Área resguardante" styleClass="block"/>
               <p:inputText styleClass="block w-full" disabled="#{vehiculoView.readOnlyEditForm}"
                            value="#{vehiculoView.vehiculoSelected.areaResguardante}"/>
               <span class="text-sm hidden"> </span>
            </p:outputPanel>
            <p:outputPanel styleClass="field col-12 md:col-6 lg:col-4 xl:col-3">
               <p:outputLabel for="@next" value="Proveedor" styleClass="block"/>
               <p:inputText styleClass="block w-full" disabled="#{vehiculoView.readOnlyEditForm}"
                            value="#{vehiculoView.vehiculoSelected.proveedor}"/>
               <span class="text-sm hidden"> </span>
            </p:outputPanel>
            <p:outputPanel styleClass="field col-12 md:col-6 lg:col-4 xl:col-3">
               <p:outputLabel for="@next" value="Director Administrativo" styleClass="block"/>
               <p:inputText styleClass="block w-full" disabled="#{vehiculoView.readOnlyEditForm}"
                            value="#{vehiculoView.vehiculoSelected.autorizaDirectorAdmin}"/>
               <span class="text-sm hidden"> </span>
            </p:outputPanel>
            <p:outputPanel styleClass="field col-12 md:col-6 lg:col-4 xl:col-3">
               <p:outputLabel for="@next" value="Director General" styleClass="block"/>
               <p:inputText styleClass="block w-full" disabled="#{vehiculoView.readOnlyEditForm}"
                            value="#{vehiculoView.vehiculoSelected.autorizaDirectorGeneral}"/>
               <span class="text-sm hidden"> </span>
            </p:outputPanel>
         </p:outputPanel>
         <p:outputPanel styleClass="w-full" rendered="#{not vehiculoView.readOnlyEditForm}">
            <p:outputPanel styleClass="flex justify-content-end">
               <p:commandButton value="Cancelar" ajax="true" process="@this"
                                action="#{vehiculoView.cancelarEdicion()}"
                                styleClass="ui-button-outlined mr-4"/>
               <p:commandButton value="Guardar" ajax="true" process="@form"
                                action="#{vehiculoView.guardarEdicion()}"
                                update="growl @form form_datatable"
                                validateClient="true"/>
            </p:outputPanel>
         </p:outputPanel>
      </p:panel>
   </h:form>
   <p:outputPanel styleClass="grid">
      <p:outputPanel styleClass="col-12 md:col-6 mb-5">
         <p:remoteCommand name="rc" actionListener="#{vehiculoView.changeActiveIndex}" update="form_galeria:galleria-vehiculo"
                          oncomplete="PF('galleriaVehiculo').show()" />
         <h:form id="form_galeria">
            <p:panel header="Fotos" styleClass="mb-5">
               <f:facet name="actions">
                  <p:commandLink styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default flex justify-content-center align-items-center"
                                 ajax="true" action="#{vehiculoView.abrirModalAdjuntarFotos(vehiculoView.vehiculoSelected.idVehiculo)}"
                                 oncomplete="Main.changeChooseLabel();" update="growl">
                     <i class="fi fi-rr-add-image"/>
                  </p:commandLink>
                  <p:commandLink styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default flex justify-content-center align-items-center mr-3"
                                 ajax="true" action="#{vehiculoView.presentGallery()}"
                                 update="form_galeria:galleria-vehiculo"
                                 oncomplete="PF('galleriaVehiculo').show()">
                     <i class="fi fi-rr-play-alt"/>
                  </p:commandLink>
               </f:facet>
               <p:outputPanel styleClass="grid" rendered="#{vehiculoView.vehiculoFotoList != null and vehiculoView.vehiculoFotoList.size() > 0}">
                  <ui:repeat value="#{vehiculoView.vehiculoFotoList}" var="vehiculoFoto" varStatus="status">
                     <p:outputPanel styleClass="col-12 md:col-4 lg:col-2">
                        <p:graphicImage value="#{fileBean.getFile(vehiculoFoto.rutaArchivo)}" alt="#{vehiculoFoto.nombreArchivo}"
                                        onclick="rc([{name: 'index', value: '#{status.index}'}])"
                                        style="width: 100%; display: block; cursor: pointer;" stream="false" styleClass="border-round-2xl mb-3" />
                        <div class="flex justify-content-center align-items-center">
                           <p:commandLink value="Borrar" styleClass="text-sm text-center"
                                          ajax="true" action="#{vehiculoView.borrarFoto(vehiculoFoto.idVehiculoFoto)}">
                              <p:confirm header="Confirmación" message="¿Estás seguro que desear borrar la foto?"
                                         icon="pi pi-exclamation-triangle"/>
                           </p:commandLink>
                        </div>
                     </p:outputPanel>
                  </ui:repeat>
               </p:outputPanel>
               <p:outputPanel styleClass="grid" rendered="#{vehiculoView.vehiculoFotoList == null or vehiculoView.vehiculoFotoList.size() == 0}">
                  <p:outputPanel styleClass="field col-12">
                     No se han registrado fotos de vehículo
                  </p:outputPanel>
               </p:outputPanel>
            </p:panel>
            <p:galleria id="galleria-vehiculo" widgetVar="galleriaVehiculo"
                        value="#{vehiculoView.vehiculoFotoList}" activeIndex="#{vehiculoView.activeIndex}"
                        var="vehiculoFoto" responsiveOptions="#{vehiculoView.responsiveOptionsGallery}"
                        numVisible="10" circular="true" fullScreen="true" showItemNavigators="true"
                        showThumbnails="false" style="max-width: 850px">
               <p:graphicImage value="#{fileBean.getFile(vehiculoFoto.rutaArchivo)}" styleClass="w-full"
                               alt="#{vehiculoFoto.nombreArchivo}" stream="false"/>
            </p:galleria>
         </h:form>
      </p:outputPanel>
      <p:outputPanel styleClass="col-12 md:col-6 mb-5">
         <h:form id="form_polizas">
            <p:panel header="Póliza vigente" widgetVar="panelPolizaVigente" styleClass="mb-5">
               <p:outputPanel styleClass="grid" rendered="#{vehiculoView.vehiculoSelected.incisoVigente != null}">
                  <p:outputPanel styleClass="field col-12 md:col-6 lg:col-4">
                     <p:outputLabel for="@next" value="Aseguradora" styleClass="block"/>
                     <p:inputText styleClass="block w-full" readonly="true"
                                  value="#{vehiculoView.vehiculoSelected.incisoVigente.poliza.aseguradora.nombre}"/>
                     <span class="text-sm hidden"> </span>
                  </p:outputPanel>
                  <p:outputPanel styleClass="field col-12 md:col-6 lg:col-4">
                     <p:outputLabel for="@next" value="Póliza" styleClass="block"/>
                     <p:inputText styleClass="block w-full" readonly="true"
                                  value="#{vehiculoView.vehiculoSelected.incisoVigente.poliza.numeroPoliza}"/>
                     <span class="text-sm hidden"> </span>
                  </p:outputPanel>
                  <p:outputPanel styleClass="field col-12 md:col-6 lg:col-4">
                     <p:outputLabel for="@next" value="Inciso" styleClass="block"/>
                     <p:inputText styleClass="block w-full" readonly="true"
                                  value="#{vehiculoView.vehiculoSelected.incisoVigente.numeroInciso}"/>
                     <span class="text-sm hidden"> </span>
                  </p:outputPanel>
                  <p:outputPanel styleClass="field col-12 md:col-6 lg:col-4">
                     <p:outputLabel for="@next" value="Fecha inicio" styleClass="block"/>
                     <p:inputText styleClass="block w-full" readonly="true"
                                  value="#{vehiculoView.vehiculoSelected.incisoVigente.fechaInicioVigencia}">
                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                     </p:inputText>
                     <span class="text-sm hidden"> </span>
                  </p:outputPanel>
                  <p:outputPanel styleClass="field col-12 md:col-6 lg:col-4">
                     <p:outputLabel for="@next" value="Fecha fin" styleClass="block"/>
                     <p:inputText styleClass="block w-full" readonly="true"
                                  value="#{vehiculoView.vehiculoSelected.incisoVigente.fechaFinVigencia}">
                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                     </p:inputText>
                     <span class="text-sm hidden"> </span>
                  </p:outputPanel>
                  <p:outputPanel styleClass="field col-12">
                     <p:commandLink value="Descargar póliza" ajax="false" onclick="PrimeFaces.monitorDownload(start, stop);" rendered="#{vehiculoView.vehiculoSelected.incisoVigente.poliza.rutaArchivo != null}">
                        <p:fileDownload value="#{fileDownloadBean.downloadFileByPath(vehiculoView.vehiculoSelected.incisoVigente.poliza.rutaArchivo)}"/>
                     </p:commandLink>
                  </p:outputPanel>
               </p:outputPanel>
               <p:outputPanel styleClass="grid" rendered="#{vehiculoView.vehiculoSelected.incisoVigente == null}">
                  <p:outputPanel styleClass="field col-12">
                     No cuenta con una póliza vigente
                  </p:outputPanel>
               </p:outputPanel>
            </p:panel>
         </h:form>
      </p:outputPanel>
   </p:outputPanel>

</ui:composition>
